# SAPT Setup & Integration Guide

This guide will walk you through setting up your SAPT instance with Firebase, running the dev server, and deploying.

## 1. Create a Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Click **Create a project** and name it (e.g., "SAPT-Demo")
3. Enable Google Analytics (optional)
4. Once created, go to **Project Settings** and scroll to **Your apps** section
5. Click **Web** icon and register the app
6. Copy the Firebase configuration object

## 2. Add Credentials to .env.local

1. In your project root (d:\project), create a file named `.env.local`
2. Copy the values from `.env.example` and paste the Firebase config:

```bash
VITE_FIREBASE_API_KEY=YOUR_API_KEY
VITE_FIREBASE_AUTH_DOMAIN=YOUR_AUTH_DOMAIN
VITE_FIREBASE_PROJECT_ID=YOUR_PROJECT_ID
VITE_FIREBASE_STORAGE_BUCKET=YOUR_STORAGE_BUCKET
VITE_FIREBASE_MESSAGING_SENDER_ID=YOUR_MESSAGING_SENDER_ID
VITE_FIREBASE_APP_ID=YOUR_APP_ID
```

3. Save the file and restart your dev server for the changes to take effect.

## 3. Enable Firebase Authentication

1. In Firebase Console, go to **Authentication > Sign-in method**
2. Enable **Email/Password** provider
3. (Optional) Enable Google, GitHub, or other OAuth providers

## 4. Create Firestore Database

1. In Firebase Console, go to **Firestore Database**
2. Click **Create Database**
3. Start in **Test Mode** (for development; switch to production rules before deploying)
4. Choose a region close to you (e.g., us-central1)

## 5. Set Up Firestore Security Rules

1. In Firestore, go to **Rules** tab
2. Replace the default rules with the contents of `src/firebase/firestoreSchema.js` (the commented security rules section)
3. Click **Publish**

## 6. Install Dependencies & Run Dev Server

From PowerShell in your project root:

```powershell
cd d:\project
npm install --legacy-peer-deps  # (already done if you ran our setup)
npm run dev
```

The app will start at `http://localhost:5173` (or the next available port).

## 7. Create a Test User

1. Open the app in your browser
2. Go to the Login page
3. Click **Sign up**
4. Enter email (e.g., admin@test.com), password, and select role **Admin**
5. Click **Sign Up**

A new user document will be created in Firestore with the role you selected.

## 8. Firestore Collections Setup

To fully test the app, manually create the following Firestore collections (or let the app create them as you use features):

```
Collection: users
  - Document: {uid} (auto-created on signup)
    Fields: uid, email, name, role, createdAt

Collection: attendance (optionalâ€”create when marking attendance)
  - Document: {auto_id}
    Fields: userId, date, status, markedAt, markedBy, method

Collection: tasks (optionalâ€”create when assigning tasks)
  - Document: {auto_id}
    Fields: title, description, assignedTo, assignedBy, dueDate, status, rating, createdAt

Collection: performance (optionalâ€”auto-generated by admin)
  - Document: {auto_id}
    Fields: userId, month, attendanceRate, tasksCompleted, averageTaskRating, flags, updatedAt

Collection: notifications (optionalâ€”auto-generated on events)
  - Document: {auto_id}
    Fields: userId, type, title, message, read, actionUrl, createdAt
```

## 9. Test Role-Based Access

1. **Admin Role**: Can access all pages, mark attendance, assign tasks, view analytics
2. **Supervisor Role**: Can mark attendance, assign tasks, view team analytics (not all users)
3. **Student/Employee Role**: Can only view own attendance, tasks, and performance

Try signing up multiple users with different roles to test the access control.

## 10. Deploy to Vercel (Recommended)

1. Push your code to GitHub
2. Go to [Vercel Dashboard](https://vercel.com)
3. Click **Import Project** and select your GitHub repo
4. Add environment variables:
   - `VITE_FIREBASE_API_KEY`, etc. (same as `.env.local`)
5. Click **Deploy**

Vercel will auto-deploy on every git push.

## 11. Deploy to Firebase Hosting (Alternative)

1. Install Firebase CLI: `npm install -g firebase-tools`
2. Login: `firebase login`
3. Initialize: `firebase init hosting`
4. Build: `npm run build`
5. Deploy: `firebase deploy --only hosting`

## Next Steps & Optional Features

### 1. Face Recognition Integration
- Add `face-api.js` or `face-recognition.js` for automated attendance
- Create an `/api/attendance/face` endpoint in Cloud Functions

### 2. Email Notifications
- Use Firebase Cloud Functions to send emails on task assignments or absences
- Integrate SendGrid or Firebase Admin SDK email

### 3. PDF Report Export
- Add `jsPDF` + `html2canvas` to generate and download reports

### 4. Advanced Analytics
- Create Firestore triggers to auto-calculate monthly performance metrics
- Add Recharts visualizations with real Firestore data

### 5. Mobile App (React Native)
- Reuse authentication and Firestore logic
- Add mobile-specific UI in Expo

### 6. Testing & CI/CD
- Add Jest + React Testing Library for unit tests
- Add GitHub Actions workflow for auto-testing and deployment

### 7. Cloud Functions for Automation
- Auto-flag low attendance/performance
- Send deadline reminder emails 24 hrs before task due date
- Archive old records

## Troubleshooting

**Error: "Cannot find module '@vitejs/plugin-react'"**
- Run `npm install --legacy-peer-deps` again

**Error: "Firebase config is missing"**
- Check that `.env.local` exists and has all VITE_FIREBASE_* variables
- Restart your dev server after adding `.env.local`

**Error: "Permission denied" on Firestore**
- Check that your security rules allow your user's role
- Make sure the user document is created with a valid `role` field

**Dev server won't start**
- Kill any existing process on port 5173: `npx kill-port 5173` (npm package)
- Restart: `npm run dev`

---

**Happy building!** ðŸš€
